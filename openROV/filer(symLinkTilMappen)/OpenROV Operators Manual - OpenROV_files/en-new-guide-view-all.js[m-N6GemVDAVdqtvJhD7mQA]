KeyboardNavigation=new Class({Implements:[Options,Events],options:{keys:{},eventSource:document,eventFilter:null},keys:{},initialize:function(b){this.setOptions(b);this.addKeys(this.options.keys);this.options.eventFilter||(this.options.eventFilter=this.filterInputs);this.options.eventSource.addEvent("keydown",this.handleKeyup.bind(this))},handleKeyup:function(b){if(this.options.eventFilter(b)){var a=this.getKeyFromEvent(b);this.checkAndDispatch(a,b)}},addKeys:function(b){Hash.each(b,this.addKey,this)},
addKey:function(b,a){var c=a.split("-"),d=c.pop(),c=c.sort().join("").toUpperCase()+d;this.keys[c]=b},getKeyFromEvent:function(b){var a=[];["alt","control","meta","shift"].each(function(c){b[c]&&a.push(c.charAt(0).toUpperCase())});return a.join("")+b.key},checkAndDispatch:function(b,a){b in this.keys&&(this.keys[b](a),a.stop())},filterInputs:function(b){return!["INPUT","TEXTAREA"].contains(b.target.tagName)&&!b.target.classList.contains("ProseMirror")}});
UpDownNavigation=new Class({Implements:[Events,Options],options:{prevKey:"k",topKey:"S-k",nextKey:"j",bottomKey:"S-j",eventSource:document,scrollContainer:window,eventFilter:null,items:[],scrollContext:8,scrollDuration:.3,scrollEase:300},items:[],currentPosition:0,initialize:function(b){this.setOptions(b);b={};b[this.options.prevKey]=this.handlePrev.bind(this);b[this.options.topKey]=this.handleTop.bind(this);b[this.options.nextKey]=this.handleNext.bind(this);b[this.options.bottomKey]=this.handleBottom.bind(this);
this.keymapper=new KeyboardNavigation({keys:b,eventSource:this.options.eventSource,eventFilter:this.options.eventFilter});this.handleScroll=this.handleScroll.bind(this);this.setUpdateOnScroll(!0);this.addItems(this.options.items);this.currentPosition=this.calculatePosition()},handlePrev:function(){var b=Math.max(0,this.currentPosition-1);b!=this.currentPosition&&(this.currentPosition=b,this.jumpToPosition(b))},handleTop:function(){0!=this.currentPosition&&(this.currentPosition=0,this.jumpToPosition(0))},
handleNext:function(){var b=Math.min(this.items.length-1,this.currentPosition+1);b!=this.currentPosition&&(this.currentPosition=b,this.jumpToPosition(b))},handleBottom:function(){var b=this.items.length-1;b!=this.currentPosition&&(this.currentPosition=b,this.jumpToPosition(b))},handleScroll:function(){this.setUpdateOnScroll(!1);var b=this.options.scrollContainer.getScroll().y,a=function(){var c=this.options.scrollContainer.getScroll().y;c==b?(this.setUpdateOnScroll(!0),c=this.calculatePosition(),
c!=this.currentPosition&&(this.currentPosition=c,this.fireEvent("setposition",[this.items[this.currentPosition].el,this.currentPosition]))):(b=c,window.setTimeout(a,this.options.scrollEase))}.bind(this);window.setTimeout(a,this.options.scrollEase)},jumpToPosition:function(b){b=this.items[b].el;this.setUpdateOnScroll(!1);this.fireEvent("beforejump",b);b.jumpTo({offset:this.options.scrollContext,duration:this.options.scrollDuration,onComplete:function(){this.setUpdateOnScroll(0<this.items.length)}.bind(this)})},
addItems:function(b){this.items=this.items.concat(b.map(function(a){return{el:a,top:a.getCoordinates(this.options.scrollContainer==window?void 0:this.options.scrollContainer).top}},this))},calculatePosition:function(){var b=this.options.scrollContainer.getScroll().y,a,c;for(a=0;a<this.items.length;a++)if(c=this.items[a],c.top>b)return a;return a-1},setUpdateOnScroll:function(b){this.options.scrollContainer[b?"addEvent":"removeEvent"]("scroll",this.handleScroll)}});
window.addEvent("domready",function(){var b=$("successButton"),a=$("doneButton"),c=$("cancelComplete"),d=function(d){d?(b.addClass("hidden"),a.removeClass("hidden"),c.removeClass("hidden")):(a.addClass("hidden"),b.removeClass("hidden"),c.addClass("hidden"))};when(c,function(){c.addEvent("click",function(b){var c=a.get("text");a.set("text",_js("Processing..."));b.stop();(new Request.API_2_0("guides/"+App.guideid+"/completed",{method:"DELETE",onSuccess:function(b){d(!1);a.set("text",c)},onError:function(a){Modal.alert(a.fail)}})).send()})});
when(b,function(){b.addEvent("click",function(a){a.stop();Auth.required({from:b,message:_js("Log in to record that you completed a repair."),onAuthorize:function(){var a=b.get("text");b.set("text",_js("Processing..."));(new Request.API_2_0("guides/"+App.guideid+"/completed",{method:"PUT",onSuccess:function(c){d(!0);b.set("text",a)},onError:function(a){Modal.alert(a.fail)},onFailure:function(a,b){Modal.alert(b)}})).send()}})})});when($("halfwayButton"),function(a){a.addEvent("click",function(a){var b=
new Element("div",{"class":"hrContentMinor"}),c=new Element("div",{id:"guideSteps"});$$(".step").reverse().each(function(a){c.adopt(a,b.clone())});c.replaces($("guideSteps"));$$(".step")[0].jumpTo({offset:5,duration:.75});$("halfwayConclusion").addClass("hidden");$("finishedConclusion").removeClass("hidden");this.addClass("hidden");$("successButton").removeClass("hidden")})})});
(function(){function b(){TweenMax.to("meter-counter",.75,{opacity:1,scaleY:1,textShadow:"0 0 30px "+g[d],ease:Elastic.easeOut});TweenMax.set("meterProgress",{attr:{"stroke-dashoffset":h}});TweenMax.set("meterStroke",{attr:{"stroke-width":18}})}function a(){"ie"!==Browser.name&&TweenMax.fromTo("meterBar",1/(d+5),{rotation:e-d/3},{rotation:e+d/6,repeat:-1,yoyo:!0})}function c(){if(!m){var c=window.getSize().y,l=f.getPosition().y;getScroll().y>l-(c-250)&&(e=27*d+135,TweenMax.fromTo("meterBar",2,{rotation:135},
{rotation:e,ease:Expo.easeIn,delay:1,onComplete:a}),h=22.7*d+227,TweenMax.fromTo("meterProgress",2,{attr:{"stroke-dashoffset":227}},{attr:{"stroke-dashoffset":h},ease:Expo.easeIn,delay:1,onComplete:b}),c=$("meterStroke"),"ie"!==Browser.name?TweenMax.to(c,2,{stroke:g[d],ease:Power1.easeOut,delay:2}):TweenMax.set(c,{stroke:g[d]}),TweenMax.set("meter-counter",{opacity:0,scaleY:0}),m=!0)}}var d=App.repairabilityScore,f,g="#E01410 #EB2C0A #EF5803 #F38800 #F4B700 #F0DC02 #DAE60D #9ADA0D #5DD113 #2DCF1C #0BCD20".split(" "),
e,h,m=!1;window.addEvent("domready",function(){if(f=$("teardownConclusion"))c(),window.addEvent("scroll:throttle(100):pause(100)",c)})})();
window.addEvent("domready",function(){function b(a,b){var c=Math.floor(.73*a),d=$$(".js-embed-"+b+".js-embed-text")[0].get("data-embed-template").replace("{width}",a);"single"==b&&(d=d.replace("{height}",c));return d}function a(a,b,c){b=void 0!==b?b:.5;var d=a.getElement(".comments-container");a=a.getElement(".js-comment-container");void 0===c&&(c=d.hasClass("closed"));d&&(c?(TweenMax.set(d,{height:"auto"}),TweenMax.set(d,{opacity:1}),TweenMax.from(d,b,{height:0,opacity:0,ease:Expo.easeOut,onComplete:function(){d.removeClass("closed")}})):
TweenMax.to(d,b,{height:0,opacity:0,ease:Expo.easeOut,onComplete:function(){d.addClass("closed")}}));a.retrieve("commentManager")||a.store("commentManager",new CommentManager(a))}function c(a,c){var d,e=$(this);d=e.hasClass("js-embed-width")?"js-embed-width":"js-embed-type";$$(".js-button-checkable."+d).removeClass("button-checked");e.addClass("button-checked");d=$$(".js-embed-width.button-checked")[0].get("data-embedWidth");e=$$(".js-embed-type.button-checked")[0].get("data-embedType");d=b(d,e);
e=$$(".js-embed-text")[0];$$(".js-embed-single").hide();$$(".js-embed-full").show();$("embedBoxIframe").set("html",d);e.set("value",d);e.select()}var d=!1,f=function(a,b){a.getParent(".js-step").getElements(".js-step-thumbnail-container").removeClass("active");a.addClass("active");var c=$(a.getAttribute("data-fullimg")),d=b.getElement("img.visible");c.src&&d&&(d.removeClass("visible"),c.addClass("visible"),d=ImageMenu.getMenu(d))&&(d.disable(),d=ImageMenu.getMenu(c),d||(d=ImageMenu.installMenu(c),
c.addClass("hasMenu")),d.enable())};onHashFragmentElement(function(b){var c=b.getParent(".js-step");c&&(a(c,0,!0),onLoad(function(){b.jumpTo({offset:0,duration:0})}))});$$(".js-step").each(function(a){var b=a.getElement(".js-step-main-media");a.getElements(".js-step-thumbnail-container").each(function(a){var c=f.pass([a,b]);a.addEvents({mouseenter:c,click:c})})});var g=function(a,b){if("img"==$(b.target).get("tag")&&!a.hasClass("noImage")&&!$(b.target).hasClass("js-no-link")){var c=a.getElement("img.visible");
(c=c&&c.get("data-biggest"))&&window.open(c,"_blank")}};$$(".step[id!=endOfGuideDiv]").each(function(a){a=a.getElement(".stepMedia.stepImage");null!==a&&a.addEvent("click",g.bind(null,a))});$$(".js-share-dropdown").each(function(a){var b=encodeURIComponent(App.canonical),c=encodeURIComponent(App.page_title);new ButtonDropdown(a,{items:[{title:_js("Embed this guide"),href:"#",icon:"code","class":"js-show-embed"},{title:"Facebook",href:"https://www.facebook.com/sharer.php?u="+b+"&t="+c,icon:"facebook-f",
"class":""},{title:"Twitter",href:"https://twitter.com/intent/tweet?text="+c+"&url="+b,icon:"twit","class":""},{title:"Google +",href:"https://plus.google.com/share?url="+b,icon:"google-plus","class":""}]})});new CommentManager($("guide-comments"));$$(".js-step .js-comment-container").each(function(a){a.getElement(".comments-container:not(.closed)")&&a.store("commentManager",new CommentManager(a))});ContentDropdownGroup($$(".js-guide-details-container"));$$(".item-list li a").each(function(a){new ItemHover(a)});
$$(".publish-guide-banner").each(function(a){var b=a.getProperty("data-guideid"),c=a.getProperty("data-guide-api-revisionid"),d=new StatusNotice(a.getElement(".status"));a.getElements(".button").addEvent("click",function(){(new Request.API_2_0("guides/"+b+"/public?revisionid="+c,{method:"put",onFailure:function(a){a=JSON.decode(a.response);var b=_js("Unable to publish guide.");a&&a.message&&(b=a.message);d.error(b);d.addCloseButton()},onSuccess:function(a){d.good(_js("Successfully published."));d.addCloseButton();
window.location.reload()}})).send()})});window.addEvents({"click:relay(.js-screen-size-item)":function(a,b){var c=b.get("data-screen-size");$$(".js-video-container").set("data-video-size",c);$$(".js-screen-size-item").removeClass("active");b.addClass("active")},"click:relay(.js-show-comments)":function(b,c){var d=c.getParent(".js-step");a(d)},"click:relay(.js-expand-comments)":function(b,c){var d=$$(".js-step").filter(function(a){return 0<a.getElement("button.js-comment-count").get("data-numcomments")}),
e=!c.getElement(".expand").hasClass("hidden");SettingsCookie.set("expand-comments",e.toString());d.each(function(b){a(b,0,e)});c.getElements(".expand, .collapse").toggleClass("hidden")},"click:relay(.js-embed-type.js-button-checkable)":c,"click:relay(.js-embed-width.js-button-checkable)":c,"click:relay(.js-show-embed)":function(a,c){var e=$("embedBox");e&&!d&&(d=!0,e.appendHTML('<div id="embedBoxIframe">'+b(800,"single")+"</div>"));Modal.open({type:"element",element:e,onLoad:function(a){(a=a.getElement(".js-embed-text"))&&
a.select()}})},"click:relay(.js-show-shareable-link)":function(a,b){var c=(new Element("div.shareable-link-container")).grab(new Element("h3",{text:_js("Shareable Link")})),d=(new Element("input",{type:"text",value:b.get("data-shareable-link")})).inject(c);Modal.open({type:"element",element:c});d.select()},"click:relay(.js-subscribe-edit)":function(){Auth.required({from:$$(".js-subscribe-edit"),message:_js("Log in to subscribe."),onAuthorize:LoadingIndicator.withEventHandler(function(a,b){var c="subscribe/guide/"+
App.guideid+"/"+App.viewLangid+"/edit";return $$(".un-subscribe-edits")[0].hasClass("hidden")?(new Request.API_2_0(c,{method:"put",onSuccess:function(a){$$(".un-subscribe-edits").removeClass("hidden");$$(".subscribe-edits").addClass("hidden")}})).send():(new Request.API_2_0(c,{method:"delete",onSuccess:function(a){$$(".subscribe-edits").removeClass("hidden");$$(".un-subscribe-edits").addClass("hidden")}})).send()},{pendingMessage:_js("Updating Subscription"),successMessage:_js("Success"),failureMessage:_js("Failure")})})}});
var e=new UpDownNavigation({items:$$(".js-step"),onBeforejump:function(){var a=8,b;if(b=$("notifications"))a+=b.getSize().y;e.options.scrollContext=a}});when($$(".time-travel .dropdown-wrapper"),function(a){a.addEvent("valuechanged",function(){var a=this.getValue();(new URI(window.location.href)).setData({revisionid:a},!0).go()})})});
ItemHover=new Class({initialize:function(b){this.li=b;this.featured=b.hasClass("featured");this.name=b.getElement(".itemName").get("text");if(this.price=b.getProperty("data-price"))this.price=this.price.toFloat();this.isForSale=null!==b.getProperty("data-is-for-sale");this.isFromExternalSupplier=null!==b.getProperty("data-external-supplier");this.subtitleText=b.getProperty("data-subtitle-text");this.subtitleClass=b.getProperty("data-subtitle-class");this.guideinfo=b.getProperty("data-guideinfo");
this.supplier=b.getProperty("data-supplier");this.imageURL=b.getProperty("data-image");this.purchaseURL=b.getProperty("data-purchaseUrl");this.wikiURL=b.getProperty("data-wikiUrl");this.editURL=b.getProperty("data-editUrl");this.text=b.getProperty("data-text");this.onPrivateSite=1==b.getProperty("data-private");this.tooltipClass=b.getProperty("data-tooltip-class")||"itemHover";this.infoButtonClass=b.getProperty("data-info-button-class")||"";this.buyButtonClass=b.getProperty("data-buy-button-class")||
"";this.tip=this.buildTooltip();b.addEvents({mouseenter:b.addClass.pass("active",b),mouseleave:b.removeClass.pass("active",b)})},buildTooltip:function(){var b=new Element("div."+this.tooltipClass),a;a=this.purchaseURL||this.wikiURL;this.imageURL&&(b.addClass("hasImage"),b.adopt((new Element("div.thumbnail")).adopt(new Element("a",{href:a,styles:{backgroundImage:"url("+this.imageURL+")"}}))));b.adopt((new Element("h3.title")).adopt(new Element("a",{href:a,text:this.name})));a=_js("Buy Now");this.isForSale?
this.isFromExternalSupplier&&this.supplier&&(a="Buy on %1".replace("%1",this.supplier)):a=_js("View Item");b.adopt(new Element("p",{text:this.subtitleText,"class":this.subtitleClass}));b.adopt(new Element("p.guideinfo",{text:this.guideinfo}));b.adopt(new Element("p.description",{html:htmlEncode(this.text)||"This {item} doesn't have a description yet, but you can help! {a1}Improve the {name} wiki{a2} with a quick explanation.".substitute({item:this.li.getParent("ul").getProperty("data-itemType"),name:htmlEncode(this.li.getElement(".itemName").get("text")),
a1:'<a target="_blank" href="'+this.editURL+'">',a2:"</a>"})}));b.adopt(new Element("div.clearer"));this.purchaseURL&&b.adopt((new Element("p.purchaseLink")).adopt(new Element("a",{text:a,target:"_blank",href:this.purchaseURL,"class":this.buyButtonClass})));this.wikiURL&&this.text&&b.adopt((new Element("p.wikiLink")).adopt(new Element("a",{text:_js("Info"),target:"_blank",href:this.wikiURL,"class":this.infoButtonClass})));b.adopt(new Element("div.clearer"));var c,d;this.featured?(a=13,c=-10,d=16):
(a=24,c=-7,d=32);return new Tooltip(this.li,{autoshow:!0,showDelay:400,side:"top",arrowAlign:"left",offset:c,nudge:a,arrowInset:d,text:b,maxWidth:300})}});
onDomReady(function(){when($$(".releaseDetailsToggle"),function(b){b.addEvent("click",function(a){a.preventDefault();a=$$(".detailsContainer");var c=b.get("data-toggleText"),d=b.get("text");b.set("data-toggleText",d);b.set("text",c);a.toggle()})});when($("guideReleaseVersionSelect"),function(b){b.addEvent("valuechanged",function(a){a=a.get("data-value")||void 0;var b=new URI(window.location);b.setData("release",a);window.location=b})});when($E(".version-type"),function(b){new Tooltip(b,{autoshow:!0,
showDelay:400,side:"bottom",arrowAlign:"left",text:new Element("p.version-type-tooltip",{text:b.getElement(".tooltip-text").get("text")}),offset:-12,maxWidth:150,arrowAlign:"center"})})});window.addEvent("domready",function(){$$("img."+NewImageMenu.enableClass).each(NewImageMenu.installMenu);LazyLoader.addEvent("postReplace",function(b){NewImageMenu.installMenu(b)})});
NewImageMenu=new Class({Implements:[Options,Events],options:{},enabled:!1,showing:!1,initialize:function(b,a,c){this.setOptions(c);this.img=b;this.guid=a;this.menu=new Element("ul");this.menu.setAttribute("class","newImageMenu");this.img.addEvents({mouseenter:this.show.bind(this),mouseleave:this.mouseLeave.bind(this)});this.enable()},show:function(){if(this.enabled){if(this.showing)return null;for(var b=this.img,a;"div"!=(a=b.getParent()).get("tag");)b=a;this.menu.inject(b,"before");b=this.img.getPosition(this.img.getOffsetParent());
0<(a=parseInt(this.img.getStyle("border-left-width"),10))&&(b.x+=a);0<(a=parseInt(this.img.getStyle("border-top-width"),10))&&(b.y+=a);this.menu.setStyles({left:b.x,top:b.y,opacity:0});TweenLite.to(this.menu,.2,{opacity:1});this.showing=!0;this.fireEvent("menushow")}return this},hide:function(){TweenLite.to(this.menu,.2,{opacity:0,onComplete:this.dispose,onCompleteParams:[this.menu]});this.showing=!1;this.fireEvent("menuhide");return this},dispose:function(b){b.dispose()},mouseLeave:function(b){(b=
b.event.relatedTarget)&&b!=this.menu&&$(b).getParent("ul")!=this.menu&&this.hide()},enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},addItem:function(b,a,c){b=new Element("a",{html:b});var d=typeof a;"string"==d?(d=a.substitute({guid:this.guid}),b.setAttribute("href",d)):"function"==d&&b.addEvent("click",function(b){b.stop();a(this.guid,this.img.getParent())}.bind(this));c&&b.set(c);return(new Element("li")).adopt(b).inject(this.menu)},hideItem:function(b){b.hide()},
showItem:function(b){b.show()}});NewImageMenu.enableClass="hasNewMenu";
NewImageMenu.installMenu=function(b){var a;if(!b.hasClass(NewImageMenu.enableClass)||!(a=NewImageMenu.parseSrc(b)))return null;var c=new NewImageMenu(b,a.guid);c.addItem('<i class="fa fa-search-plus " ></i> ',"/Guide/Image/meta/redirect/original/"+a.guid,{target:"_blank",title:"View Original"});!b.hasClass("noCopy")&&Auth.isLoggedIn()&&c.addItem('<i class="fa fa-files-o " ></i>',function(a,b){MediaItem.copyToMediaLibrary(a,"GuideImage",null,b)},{title:"Copy to Media Manager","class":"copy-media"});
c.addItem('<i class="fa fa-info-circle " ></i>',"/Guide/Image/meta/"+a.guid,{title:"View Metadata"});b.store("NewImageMenu:imageMenu",c);return c};NewImageMenu.getMenu=function(b){return b.retrieve("NewImageMenu:imageMenu")};NewImageMenu.parseSrc=function(b){return(b=b.getAttribute("src").match(/\/([a-zA-Z0-9]+)(\.(\w+))?($|\?)/))?{guid:b[1],size:b[2]}:!1};
